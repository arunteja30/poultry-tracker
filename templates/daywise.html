{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 data-i18n="daywise_title">Daywise Entries</h2>
  <div class="d-none d-md-block">
    <a href="{{ url_for('daily') }}" class="btn btn-sm btn-success me-2" data-i18n="add_report_btn">‚ûï Add Report</a>
    {% if session.role == 'admin' %}
    <form method="POST" action="{{ url_for('recalculate_feed_averages') }}" style="display: inline;">
      <button type="submit" class="btn btn-sm btn-outline-primary" onclick="return confirm('Recalculate all average feed per bird values? This will overwrite existing values.')">
        üîÑ Recalculate Feed Averages
      </button>
    </form>
    {% endif %}
  </div>
</div>

<!-- Floating Add Button for Mobile -->
<a href="{{ url_for('daily') }}" class="d-md-none btn btn-success rounded-circle shadow" style="position: fixed; bottom: 24px; right: 24px; width: 56px; height: 56px; display: flex; align-items: center; justify-content: center; z-index: 1000; font-size: 2rem;" data-i18n="add_report_btn_mobile">
  <span aria-label="Add Report">+</span>
</a>

<!-- Desktop Table View -->
<div class="card d-none d-md-block">
  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
      <tr>
        <th data-i18n="table_day">Day</th>
        <th data-i18n="table_date">Date</th>
        <th data-i18n="table_mortality">Mortality</th>
        <th data-i18n="birds_survived">Birds Survived</th> <!-- Added column -->
        <th data-i18n="table_feed_consumed">Feed Consumed</th>
        <th data-i18n="table_feed_added">Feed Added</th>
        <th data-i18n="table_avg_weight">Avg Weight</th>
        <th data-i18n="avg_feed_per_bird">Avg Feed/Bird</th>
        <th data-i18n="table_fcr">FCR</th>
        <th data-i18n="table_medicines">Medicines</th>
        <th data-i18n="table_notes">Notes</th>
        {% if session.role == 'admin' %}
        <th>Actions</th>
        {% endif %}
      </tr>
      </thead>
      <tbody>
      {% for r in rows|reverse %}
      <tr>
        <td class="text-center">Day {{ loop.revindex }}</td>
        <td class="text-center">{{ r.entry_date }}</td>
        <td class="text-center">{{ r.mortality }}</td>
        <td class="text-center">{{ r.birds_survived }}</td> <!-- Added value -->
        <td class="text-center">{{ r.feed_bags_consumed }}</td>
        <td class="text-center">{{ r.feed_bags_added }}</td>
        <td class="text-center">{{ "{:,.0f}".format(r.avg_weight * 1000) }}g ({{ r.avg_weight }}kg)</td>
        <td class="text-center">{{ "{:,.1f}".format(r.avg_feed_per_bird_g) }}g</td>
        <td class="text-center">{{ r.fcr }}</td>
        <td class="text-center">{{ r.medicines or '-' }}</td>
        <td>{{ r.daily_notes or '-' }}</td>
        {% if session.role == 'admin' %}
        <td class="text-center">
          <form method="POST" action="{{ url_for('delete_daily', entry_id=r.id) }}" style="display: inline;"
                onsubmit="return confirm('Are you sure you want to delete this entry? This action cannot be undone.')">
            <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete Entry">
              üóëÔ∏è
            </button>
          </form>
        </td>
        {% endif %}
      </tr>
      {% else %}
      <tr>
        <td colspan="{% if session.role == 'admin' %}11{% else %}10{% endif %}" class="text-center" data-i18n="no_entries">No entries found</td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Mobile Card View -->
<div class="d-block d-md-none">
  {% for r in rows|reverse %}
  <div class="card mb-3 shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <strong>Day {{ loop.revindex }}</strong>
        <span class="text-muted">{{ r.entry_date }}</span>
      </div>
      <div>
        <span class="text-secondary" data-i18n="table_mortality">Mortality:</span>
        <span class="fw-bold text-danger">{{ r.mortality }}</span><br>
        <span class="text-secondary" data-i18n="table_feed_consumed">Feed Consumed:</span>
        <span class="fw-bold text-info">{{ r.feed_bags_consumed }}</span><br>
        <span class="text-secondary" data-i18n="table_feed_added">Feed Added:</span>
        <span class="fw-bold text-success">{{ r.feed_bags_added }}</span><br>
        <span class="text-secondary" data-i18n="table_avg_weight">Avg Weight:</span>
        <span class="fw-bold text-warning">{{ "{:,.0f}".format(r.avg_weight * 1000) }}g ({{ r.avg_weight }}kg)</span><br>
        <span class="text-secondary" data-i18n="avg_feed_per_bird">Avg Feed/Bird:</span>
        <span class="fw-bold text-primary">{{ "{:,.1f}".format(r.avg_feed_per_bird_g) }}g</span><br>
        <span class="text-secondary" data-i18n="table_fcr">FCR:</span>
        <span class="fw-bold text-success">{{ r.fcr }}</span><br>
        <span class="text-secondary" data-i18n="table_medicines">Medicines:</span>
        <span class="fw-bold text-dark">{{ r.medicines or '-' }}</span><br>
        <span class="text-secondary" data-i18n="table_notes">Notes:</span>
        <span class="fw-bold text-dark">{{ r.daily_notes or '-' }}</span>
      </div>
      {% if session.role == 'admin' %}
      <div class="mt-2">
        <form method="POST" action="{{ url_for('delete_daily', entry_id=r.id) }}" style="display: inline;"
              onsubmit="return confirm('Are you sure you want to delete this entry? This action cannot be undone.')">
          <button type="submit" class="btn btn-sm btn-outline-danger w-100" title="Delete Entry">
            üóëÔ∏è Delete
          </button>
        </form>
      </div>
      {% endif %}
    </div>
  </div>
  {% else %}
  <div class="card mb-3">
    <div class="card-body text-center text-muted" data-i18n="no_entries">
      No entries found
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}