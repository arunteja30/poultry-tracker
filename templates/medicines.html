{% extends 'base.html' %}
{% block content %}
<h2 data-i18n="meds_title">Medicine Sheet</h2>

<div class="card p-4 mb-4">
  <h5 data-i18n="add_new_medicine">Add New Medicine</h5>
  <form method="POST" class="row g-3">
    <div class="col-md-4">
      <label for="med-name" class="form-label" data-i18n="medicine_name">Medicine Name</label>
      <input id="med-name" data-i18n-placeholder="med_name_ph" name="name" class="form-control" placeholder="Medicine name" required>
    </div>
    <div class="col-md-3">
      <label for="med-price" class="form-label" data-i18n="medicine_price">Price</label>
      <input id="med-price" data-i18n-placeholder="med_price_ph" name="price" class="form-control" placeholder="Price" type="number" step="0.01">
    </div>
    <div class="col-md-3">
      <label for="med-qty" class="form-label" data-i18n="medicine_qty">Quantity</label>
      <input id="med-qty" data-i18n-placeholder="med_qty_ph" name="qty" class="form-control" placeholder="Qty" type="number">
    </div>
    <div class="col-md-2 d-flex align-items-end">
      <button class="btn btn-success w-100" type="submit" data-i18n="add_med">Add</button>
    </div>
  </form>
</div>

<!-- Desktop Table View -->
<div class="card d-none d-md-block">
  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th data-i18n="table_medicine_name">Name</th>
          <th data-i18n="table_medicine_price">Price</th>
          <th data-i18n="table_medicine_qty">Quantity</th>
          {% if session.role == 'admin' %}
          <th data-i18n="table_actions">Actions</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for m in meds %}
          <tr>
            <td>{{ m.name }}</td>
            <td>₹{{ m.price }}</td>
            <td>{{ m.qty }}</td>
            {% if session.role == 'admin' %}
            <td>
              <form method="POST" action="{{ url_for('delete_medicine', medicine_id=m.id) }}" style="display: inline;" 
                    onsubmit="return confirm('Are you sure you want to delete this medicine?');">
                <button type="submit" class="btn btn-danger btn-sm">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </form>
            </td>
            {% endif %}
          </tr>
        {% else %}
          <tr>
            <td colspan="{% if session.role == 'admin' %}4{% else %}3{% endif %}" class="text-center" data-i18n="no_meds">No medicines yet</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="card-footer">
    <div class="row">
      <div class="col-md-8"></div>
      <div class="col-md-4">
        <strong data-i18n="total_amount">Total Amount: </strong>
        <span class="text-success fw-bold">₹{{ "%.2f"|format(total_amount|float) }}</span>
      </div>
    </div>
  </div>
</div>

<!-- Mobile Card View -->
<div class="d-block d-md-none">
  {% for m in meds %}
    <div class="card mb-3 shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <strong>{{ m.name }}</strong>
          <span class="badge bg-info text-dark"> ₹{{ m.price }} <span ></span></span>
        </div>
        <div>
          <span data-i18n="table_medicine_qty">Qty:</span> {{ m.qty }}<br>

        </div>
        {% if session.role == 'admin' %}
        <div class="mt-2">
          <form method="POST" action="{{ url_for('delete_medicine', medicine_id=m.id) }}" style="display: inline;" 
                onsubmit="return confirm('Are you sure you want to delete this medicine?');">
            <button type="submit" class="btn btn-danger btn-sm w-100">
              <i class="fas fa-trash"></i> <span data-i18n="btn_delete">Delete</span>
            </button>
          </form>
        </div>
        {% endif %}
      </div>
    </div>
  {% else %}
    <div class="card mb-3">
      <div class="card-body text-center text-muted" data-i18n="no_meds">
        No medicines yet
      </div>
    </div>
  {% endfor %}
  <div class="card">
    <div class="card-body text-end">
      <strong data-i18n="total_amount">Total Amount: </strong>
      <span class="text-success fw-bold">₹{{ "%.2f"|format(total_amount|float) }}</span>
    </div>
  </div>
</div>
{% endblock %}
