{% extends 'base.html' %}
{% block content %}
<h2 data-i18n="setup_title">Initial Setup</h2>

{% if existing_cycle %}
<div class="alert alert-warning mb-4">
  <h5 data-i18n="existing_cycle_warning">⚠️ Active Cycle Found</h5>
  <p data-i18n="existing_cycle_msg">
    You have an active cycle with {{ existing_cycle.current_birds }} birds started on {{ existing_cycle.start_date }}.
    Starting a new cycle will archive the current one.
  </p>
</div>
{% endif %}

<div class="card p-4">
  <div class="row">
    <div class="col-md-8">
      <h5 data-i18n="setup_subtitle">Configure your poultry cycle</h5>
      <form method="POST" class="row g-3">
        {% if existing_cycle %}
        <input type="hidden" name="action" value="reset">
        {% else %}
        <input type="hidden" name="action" value="new">
        {% endif %}

        <div class="col-md-4">
          <label for="start-birds" class="form-label" data-i18n="start_birds">Start Birds</label>
          <input id="start-birds" data-i18n-placeholder="start_birds_ph" type="number" name="start_birds" class="form-control" required min="1">
        </div>
        <div class="col-md-4">
          <label for="start-feed" class="form-label" data-i18n="start_feed">Start Feed Bags</label>
          <input id="start-feed" data-i18n-placeholder="start_feed_ph" type="number" step="0.1" name="start_feed_bags" class="form-control" required min="0">
        </div>
        <div class="col-md-4">
          <label for="start-date" class="form-label" data-i18n="arrival_dt">Arrival Date</label>
          <input id="start-date" type="date" name="start_date" class="form-control" value="{{ today }}">
        </div>
        <div class="col-md-4">
          <label for="start-time" class="form-label" data-i18n="arrival_time">Arrival Time</label>
          <input id="start-time" type="time" name="start_time" class="form-control">
        </div>
        <div class="col-md-8">
          <label for="driver" class="form-label" data-i18n="driver">Driver Name</label>
          <input id="driver" data-i18n-placeholder="driver_ph" type="text" name="driver" class="form-control">
        </div>
        <div class="col-12">
          <label for="notes" class="form-label" data-i18n="notes">Notes</label>
          <textarea id="notes" data-i18n-placeholder="notes_ph" name="notes" class="form-control" rows="3"></textarea>
        </div>
        <div class="col-12">
          <div class="alert alert-warning">
            <small data-i18n="setup_info">This will start a new poultry cycle. Make sure all information is correct.</small>
          </div>
        </div>
        <div class="col-12">
          <button class="btn btn-success btn-lg" type="submit" data-i18n="save">
            {% if existing_cycle %}
            🔄 Start New Cycle
            {% else %}
            🐔 Create Cycle
            {% endif %}
          </button>
        </div>
      </form>
    </div>

    <div class="col-md-4">
      <div class="card bg-info bg-opacity-10 border-info">
        <div class="card-body">
          <h6 data-i18n="other_options">🔧 Other Options</h6>
          <div class="d-grid gap-2">
            {% if session.role == 'admin' %}
            <a href="{{ url_for('import_data') }}" class="btn btn-outline-info btn-sm" data-i18n="import_data_link">
              📥 Import Data
            </a>
            {% endif %}
            <a href="{{ url_for('cycle_history') }}" class="btn btn-outline-primary btn-sm" data-i18n="view_cycle_history">
              🔄 View Cycle History
            </a>
            <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary btn-sm" data-i18n="back_to_dashboard">
              🏠 Back to Dashboard
            </a>
            {% if existing_cycle and session.role == 'admin' %}
            <a href="{{ url_for('export') }}" class="btn btn-outline-success btn-sm" data-i18n="backup_current">
              💾 Backup Current Data
            </a>
            {% endif %}
          </div>
        </div>
      </div>

      {% if existing_cycle %}
      <div class="card bg-warning bg-opacity-10 border-warning mt-3">
        <div class="card-body">
          <h6 data-i18n="current_cycle_info">📊 Current Cycle Info</h6>
          <small class="text-muted">
            <strong data-i18n="start_date">Start Date:</strong> {{ existing_cycle.start_date }}<br>
            <strong data-i18n="live_birds">Live Birds:</strong> {{ existing_cycle.current_birds }}<br>
            <strong data-i18n="feed_bags">Feed Bags:</strong> {{ existing_cycle.start_feed_bags|round|int }}<br>
            <strong data-i18n="driver">Driver:</strong> {{ existing_cycle.driver or 'N/A' }}
          </small>
        </div>
      </div>
      {% else %}
      <div class="card bg-info bg-opacity-10 border-info mt-3">
        <div class="card-body">
          <h6 data-i18n="unarchive_info">🔄 Unarchive Option</h6>
          <small class="text-muted" data-i18n="unarchive_desc">
            If you have archived cycles, you can unarchive them from the Cycle History page instead of creating a new cycle.
          </small>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
