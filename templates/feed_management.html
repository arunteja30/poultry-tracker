{% extends 'base.html' %}
{% block content %}
<div class="mobile-container">
  <h2 class="mobile-header text-center mb-mobile-3" data-i18n="feed_management_title">
    <span data-i18n="feed_management_title">ðŸŒ¾ Feed Management</span>
  </h2>
  
  <div class="mobile-section">
    <div class="mobile-card card">
      <div class="card-header bg-success text-white p-mobile-2">
        <h6 class="mb-0" data-i18n="add_new_feed">âž• Add New Feed</h6>
      </div>
      <div class="card-body p-mobile-2">
        <form method="POST">
          <div class="row g-2">
            <div class="col-12 col-md-6">
              <label for="bill_number" class="form-label mobile-content" data-i18n="feed_bill_no">Bill Number</label>
              <input id="bill_number" name="bill_number" type="text" class="mobile-input form-control" required>
            </div>
            <div class="col-12 col-md-6">
              <label for="date" class="form-label mobile-content" data-i18n="feed_date">Date</label>
              <input id="date" name="date" type="date" class="mobile-input form-control" value="{{ current_date }}" required>
            </div>
            <div class="col-12">
              <label for="feed_name" class="form-label mobile-content" data-i18n="feed_name">Feed Name</label>
              <input id="feed_name" name="feed_name" type="text" class="mobile-input form-control" required>
            </div>
            <div class="col-6 col-md-4">
              <label for="feed_bags" class="form-label mobile-content" data-i18n="feed_bags">Bags</label>
              <input id="feed_bags" name="feed_bags" type="number" min="1" class="mobile-input form-control" required>
            </div>
            <div class="col-6 col-md-4">
              <label for="bag_weight" class="form-label mobile-content" data-i18n="feed_bag_weight">Weight (kg)</label>
              <input id="bag_weight" name="bag_weight" type="number" step="0.01" class="mobile-input form-control" value="50" required>
            </div>
            <div class="col-12 col-md-4">
              <label for="price_per_kg" class="form-label mobile-content" data-i18n="feed_price_per_kg">Price/kg (â‚¹)</label>
              <input id="price_per_kg" name="price_per_kg" type="number" step="0.01" class="mobile-input form-control" value="45" required>
            </div>
          </div>
          <div class="mt-3">
            <button type="submit" class="mobile-button btn btn-success w-100" data-i18n="feed_add_btn">ðŸŒ¾ Add Feed</button>
          </div>
        </form>
      </div>
    </div>
  </div>


<div class="card">
  <div class="card-body">
    <h5 data-i18n="feed_list_header">Feed List</h5>
    <!-- Desktop Table View -->
    <div class="d-none d-md-block">
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th data-i18n="feed_bill_no">Bill No</th>
            <th data-i18n="feed_date">Date</th>
            <th data-i18n="feed_name">Feed Name</th>
            <th data-i18n="feed_bags">Bags</th>
            <th data-i18n="feed_bag_weight">Bag Weight (kg)</th>
            <th data-i18n="feed_total_feed">Total Feed (kg)</th>
            <th data-i18n="feed_price_per_kg">Price/kg (â‚¹)</th>
            <th data-i18n="feed_total_cost">Total Cost (â‚¹)</th>
            <th data-i18n="audit_info">Created By/Date</th>
            {% if current_user and current_user.role in ['admin', 'super_admin'] %}
            <th data-i18n="actions">Actions</th>
            {% endif %}
          </tr>
        </thead>
        <tbody>
          {% for feed in feeds %}
          <tr>
            <td>{{ feed.bill_number }}</td>
            <td>{{ feed.date }}</td>
            <td>{{ feed.feed_name }}</td>
            <td>{{ feed.feed_bags }}</td>
            <td>{{ feed.bag_weight }}</td>
            <td>{{ feed.total_feed_kg }}</td>
            <td>{{ feed.price_per_kg }}</td>
            <td>{{ feed.total_cost }}</td>
            <td>
              <small class="text-muted">
                {% if feed.created_date %}
                  {{ feed.created_date|safe_strftime }}
                {% endif %}
                {% if feed.created_by %}
                  {% set created_user = get_user_by_id(feed.created_by) %}
                  <br>by {{ created_user.full_name or created_user.username if created_user else 'User ID ' + feed.created_by|string }}
                {% endif %}
                {% if feed.modified_date %}
                  <br><i class="bi bi-pencil me-1"></i>{{ feed.modified_date|safe_strftime }}
                  {% if feed.modified_by %}
                    {% set modified_user = get_user_by_id(feed.modified_by) %}
                    by {{ modified_user.full_name or modified_user.username if modified_user else 'User ID ' + feed.modified_by|string }}
                  {% endif %}
                {% endif %}
              </small>
            </td>
            {% if current_user and current_user.role in ['admin', 'super_admin'] %}
            <td>
              <a href="{{ url_for('edit_feed', feed_id=feed.id) }}" class="btn btn-sm btn-outline-primary me-1" title="Edit Feed Entry">
                <i class="bi bi-pencil"></i> Edit
              </a>
              <form method="POST" action="{{ url_for('delete_feed', feed_id=feed.id) }}" style="display: inline;" 
                    onsubmit="return confirm('Are you sure you want to delete this feed entry: {{ feed.feed_name }} (Bill: {{ feed.bill_number }})?');">
                <button type="submit" class="btn btn-sm btn-danger" title="Delete Feed Entry">
                  <i class="bi bi-trash"></i> Delete
                </button>
              </form>
            </td>
            {% endif %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!-- Mobile Card View -->
    <div class="d-block d-md-none">
      {% if feeds %}
        {% for feed in feeds %}
          <div class="border rounded p-3 mb-3">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h6 class="mb-0"><strong>{{ feed.feed_name }}</strong></h6>
              {% if current_user and current_user.role in ['admin', 'super_admin'] %}
              <div>
                <a href="{{ url_for('edit_feed', feed_id=feed.id) }}" class="btn btn-sm btn-outline-primary me-1" title="Edit Feed Entry">
                  <i class="bi bi-pencil"></i>
                </a>
                <form method="POST" action="{{ url_for('delete_feed', feed_id=feed.id) }}" style="display: inline;" 
                      onsubmit="return confirm('Are you sure you want to delete this feed entry: {{ feed.feed_name }} (Bill: {{ feed.bill_number }})?');">
                  <button type="submit" class="btn btn-sm btn-danger" title="Delete Feed Entry">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
              </div>
              {% endif %}
            </div>
            <div><strong data-i18n="feed_bill_no">Bill No:</strong> {{ feed.bill_number }}</div>
            <div><strong data-i18n="feed_date">Date:</strong> {{ feed.date }}</div>
            <div><strong data-i18n="feed_bags">Bags:</strong> {{ feed.feed_bags }}</div>
            <div><strong data-i18n="feed_bag_weight">Bag Weight (kg):</strong> {{ feed.bag_weight }}</div>
            <div><strong data-i18n="feed_total_feed">Total Feed (kg):</strong> {{ feed.total_feed_kg }}</div>
            <div><strong data-i18n="feed_price_per_kg">Price/kg (â‚¹):</strong> {{ feed.price_per_kg }}</div>
            <div><strong data-i18n="feed_total_cost">Total Cost (â‚¹):</strong> {{ feed.total_cost }}</div>
            
            <!-- Audit Trail Information -->
            <div class="pt-2 mt-2 border-top">
              <small class="text-muted">
                <i class="bi bi-clock me-1"></i>
                {% if feed.created_date %}
                  Created: {{ feed.created_date|safe_strftime }}
                {% endif %}
                {% if feed.created_by %}
                  {% set created_user = get_user_by_id(feed.created_by) %}
                  by {{ created_user.full_name or created_user.username if created_user else 'User ID ' + feed.created_by|string }}
                {% endif %}
                {% if feed.modified_date %}
                  <br><i class="bi bi-pencil me-1"></i>
                  Modified: {{ feed.modified_date|safe_strftime }}
                  {% if feed.modified_by %}
                    {% set modified_user = get_user_by_id(feed.modified_by) %}
                    by {{ modified_user.full_name or modified_user.username if modified_user else 'User ID ' + feed.modified_by|string }}
                  {% endif %}
                {% endif %}
              </small>
            </div>
          </div>
        {% endfor %}
        <div class="mt-2 text-end">
          <strong data-i18n="feed_total_feed_cost">Total Feed Cost:</strong> <span class="text-success">â‚¹{{ total_cost }}</span>
        </div>
      {% else %}
        <div class="text-muted text-center" data-i18n="feed_no_entries">No feed entries found.</div>
      {% endif %}
    </div>
  </div>
</div>


{% endblock %}

{% block scripts %}

<style>
/* Mobile-friendly button improvements */
@media (max-width: 576px) {
  .btn-sm {
    min-height: 36px;
    min-width: 36px;
    padding: 0.25rem 0.5rem;
  }
  
  .border.rounded {
    border: 1px solid #dee2e6 !important;
    border-radius: 0.375rem !important;
    background-color: #f8f9fa;
  }
  
  .border.rounded:hover {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
}

.btn-danger:hover {
  transform: scale(1.05);
  transition: transform 0.2s ease-in-out;
}
</style>
{% endblock %}
