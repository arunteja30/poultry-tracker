{% extends 'base.html' %}
{% block content %}
<div class="mobile-container">
  <div class="row">
    <div class="col-12">
      <!-- Header Section -->
      <div class="mobile-card mb-4">
        <div class="card-body">
          <h1 class="mobile-title" data-i18n="title"><span data-i18n="title">Poultry Feed Schedule ‚Äî Day 1 to Day 40</span></h1>
          <p class="lead mb-3" data-i18n="lead">
            <span data-i18n="lead">This guide shows daily mixing ratios of <strong>Company feed</strong> and <strong>Your feed</strong> per 100 kg total feed. 
            Use the recipe below for "Your feed" (finisher-type mix). Monitor performance and keep 2 days of pure company feed as backup.</span>
          </p>
          
          <!-- Language Selector -->
          <div class="mobile-form-section">
            <label for="language" class="form-label">
              <i class="bi bi-globe me-2"></i><span data-i18n="chooseLang">Choose language:</span>
            </label>
            <select id="language" class="form-select mobile-form-control">
              <option value="en">English</option>
              <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
              <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
              <option value="es">Espa√±ol (Spanish)</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Mixing Table Section -->
      <div class="mobile-card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h2 class="card-title mb-0" data-i18n="mixingTable"><span data-i18n="mixingTable">Day-wise Mixing Table (per 100 kg)</span></h2>
          <button class="btn btn-sm btn-outline-primary mobile-collapse-btn" type="button" data-bs-toggle="collapse" data-bs-target="#mixingTableCollapse" aria-expanded="true">
            <span class="expand-text" data-i18n="collapse"><span data-i18n="collapse">üîº</span></span>
            <span class="collapse-text d-none" data-i18n="expand"><span data-i18n="expand">üîΩ</span></span>
          </button>
        </div>
        <div class="collapse show" id="mixingTableCollapse">
          <div class="card-body p-0">
            <!-- Desktop Table -->
            <div class="table-responsive d-none d-lg-block">
              <table class="table table-striped mb-0">
                <thead class="table-dark">
                  <tr>
                    <th style="width:10%" data-i18n="day"><span data-i18n="day">Day</span></th>
                    <th style="width:25%" data-i18n="companyFeed"><span data-i18n="companyFeed">Company Feed (kg)</span></th>
                    <th style="width:25%" data-i18n="yourFeed"><span data-i18n="yourFeed">Your Feed (kg)</span></th>
                    <th style="width:40%" data-i18n="remark"><span data-i18n="remark">Remark / Phase</span></th>
                  </tr>
                </thead>
                <tbody id="feedTableDesktop">
                  <!-- Generated by JavaScript -->
                </tbody>
              </table>
            </div>

            <!-- Mobile Cards -->
            <div class="d-lg-none p-3" id="feedCardsMobile">
              <!-- Generated by JavaScript -->
            </div>
          </div>
        </div>
      </div>

      <!-- Feed Recipe Section -->
      <div class="mobile-card">
        <div class="card-header">
          <h2 class="card-title mb-0" data-i18n="finisherRecipe">Your Feed Recipe (Finisher-type)</h2>
        </div>
        <div class="card-body">
          <div class="mobile-alert-info p-3 rounded mb-3">
            <p class="mb-0" data-i18n="recipeDesc">Mix these ingredients to create "Your feed" for the ratios shown above:</p>
          </div>
          
          <div class="bg-dark text-light p-3 rounded" style="font-family: monospace;">
            <div class="row">
              <div class="col-6 col-md-3 mb-2">
                <strong data-i18n="maize">Maize:</strong> 60%
              </div>
              <div class="col-6 col-md-3 mb-2">
                <strong data-i18n="soybeanMeal">Soybean meal:</strong> 25%
              </div>
              <div class="col-6 col-md-3 mb-2">
                <strong data-i18n="riceBran">Rice bran:</strong> 8%
              </div>
              <div class="col-6 col-md-3 mb-2">
                <strong data-i18n="limestone">Limestone:</strong> 4%
              </div>
              <div class="col-6 col-md-3 mb-2">
                <strong data-i18n="salt">Salt:</strong> 0.3%
              </div>
              <div class="col-6 col-md-3 mb-2">
                <strong data-i18n="premix">Premix:</strong> 0.25%
              </div>
              <div class="col-6 col-md-3 mb-2">
                <strong data-i18n="lysine">Lysine:</strong> 0.2%
              </div>
              <div class="col-6 col-md-3 mb-2">
                <strong data-i18n="methionine">Methionine:</strong> 0.15%
              </div>
            </div>
          </div>
          
          <div class="mt-3">
            <small class="text-muted" data-i18n="recipeNote">
              <i class="bi bi-info-circle me-1"></i>
              Adjust ratios based on local ingredient availability and nutritional analysis.
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Mobile-first feed schedule app
  class FeedScheduleApp {
    constructor() {
      this.isMobile = window.innerWidth <= 768;
      this.translations = {
        hi: {
          title: "‡§Æ‡•Å‡§∞‡•ç‡§ó‡•Ä ‡§Ü‡§π‡§æ‡§∞ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‚Äî ‡§¶‡§ø‡§® 1 ‡§∏‡•á ‡§¶‡§ø‡§® 40",
          day: "‡§¶‡§ø‡§®",
          companyFeed: "‡§ï‡§Ç‡§™‡§®‡•Ä ‡§´‡•Ä‡§° (‡§ï‡§ø‡§≤‡•ã)",
          yourFeed: "‡§Ü‡§™‡§ï‡§æ ‡§´‡•Ä‡§° (‡§ï‡§ø‡§≤‡•ã)",
          remark: "‡§ü‡§ø‡§™‡•ç‡§™‡§£‡•Ä / ‡§ö‡§∞‡§£"
        },
        te: {
          title: "‡∞ï‡±ã‡∞°‡∞ø ‡∞Ü‡∞π‡∞æ‡∞∞ ‡∞∑‡±Ü‡∞°‡±ç‡∞Ø‡±Ç‡∞≤‡±ç ‚Äî ‡∞∞‡±ã‡∞ú‡±Å 1 ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞∞‡±ã‡∞ú‡±Å 40",
          day: "‡∞∞‡±ã‡∞ú‡±Å",
          companyFeed: "‡∞ï‡∞Ç‡∞™‡±Ü‡∞®‡±Ä ‡∞´‡±Ä‡∞°‡±ç (‡∞ï‡∞ø‡∞≤‡±ã)",
          yourFeed: "‡∞Æ‡±Ä ‡∞´‡±Ä‡∞°‡±ç (‡∞ï‡∞ø‡∞≤‡±ã)",
          remark: "‡∞ó‡∞Æ‡∞®‡∞ø‡∞ï / ‡∞¶‡∞∂"
        }
      };
      this.init();
    }

    init() {
      this.generateFeedSchedule();
      this.setupLanguageSelector();
      this.setupCollapseHandlers();
      if (this.isMobile) {
        this.addTouchFeedback();
      }
    }

    generateFeedSchedule() {
      const desktopTableBody = document.getElementById('feedTableDesktop');
      const mobileContainer = document.getElementById('feedCardsMobile');
      
      for (let day = 1; day <= 40; day++) {
        const feedData = this.getFeedData(day);
        
        // Desktop table row
        const tableRow = `
          <tr class="${this.getPhaseClass(day)}">
            <td><strong>${day}</strong></td>
            <td><span class="badge bg-primary">${feedData.companyFeed} kg</span></td>
            <td><span class="badge bg-success">${feedData.yourFeed} kg</span></td>
            <td><small>${feedData.remark}</small></td>
          </tr>
        `;
        desktopTableBody.insertAdjacentHTML('beforeend', tableRow);

        // Mobile card
        const mobileCard = `
          <div class="mobile-card mb-3 ${this.getPhaseClass(day)}">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="card-title mb-0">Day ${day}</h6>
                <span class="badge ${this.getPhaseBadge(day)}">${this.getPhaseText(day)}</span>
              </div>
              <div class="row">
                <div class="col-6">
                  <small class="text-muted">Company Feed:</small><br>
                  <strong class="text-primary">${feedData.companyFeed} kg</strong>
                </div>
                <div class="col-6">
                  <small class="text-muted">Your Feed:</small><br>
                  <strong class="text-success">${feedData.yourFeed} kg</strong>
                </div>
              </div>
              <div class="mt-2">
                <small class="text-muted">${feedData.remark}</small>
              </div>
            </div>
          </div>
        `;
        mobileContainer.insertAdjacentHTML('beforeend', mobileCard);
      }
    }

    getFeedData(day) {
      if (day <= 10) {
        return {
          companyFeed: 100,
          yourFeed: 0,
          remark: "Starter phase - full company feed"
        };
      } else if (day <= 20) {
        return {
          companyFeed: 70,
          yourFeed: 30,
          remark: "Gradual introduction of your feed"
        };
      } else if (day <= 30) {
        return {
          companyFeed: 50,
          yourFeed: 50,
          remark: "Balanced mix"
        };
      } else {
        return {
          companyFeed: 30,
          yourFeed: 70,
          remark: "Finisher phase - more of your feed"
        };
      }
    }

    getPhaseClass(day) {
      if (day <= 10) return 'table-info border-info';
      if (day <= 20) return 'table-warning border-warning';
      if (day <= 30) return 'table-primary border-primary';
      return 'table-success border-success';
    }

    getPhaseBadge(day) {
      if (day <= 10) return 'bg-info';
      if (day <= 20) return 'bg-warning';
      if (day <= 30) return 'bg-primary';
      return 'bg-success';
    }

    getPhaseText(day) {
      if (day <= 10) return 'Starter';
      if (day <= 20) return 'Grower';
      if (day <= 30) return 'Developer';
      return 'Finisher';
    }

    setupLanguageSelector() {
      const langSelect = document.getElementById('language');
      langSelect.addEventListener('change', (e) => {
        const lang = e.target.value;
        this.translatePage(lang);
      });
    }

    translatePage(lang) {
      if (lang === 'en') {
        document.querySelectorAll('[data-i18n]').forEach(el => {
          const original = el.getAttribute('data-original');
          if (original) {
            el.innerHTML = original;
          }
        });
        return;
      }

      const translations = this.translations[lang];
      if (!translations) return;

      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[key]) {
          if (!el.getAttribute('data-original')) {
            el.setAttribute('data-original', el.innerHTML);
          }
          el.innerHTML = translations[key];
        }
      });
    }

    setupCollapseHandlers() {
      const collapseElement = document.getElementById('mixingTableCollapse');
      const toggleButton = document.querySelector('[data-bs-target="#mixingTableCollapse"]');
      
      if (collapseElement && toggleButton) {
        collapseElement.addEventListener('shown.bs.collapse', () => {
          this.updateCollapseButton(toggleButton, true);
        });
        
        collapseElement.addEventListener('hidden.bs.collapse', () => {
          this.updateCollapseButton(toggleButton, false);
        });
      }
    }

    updateCollapseButton(button, isExpanded) {
      const expandText = button.querySelector('.expand-text');
      const collapseText = button.querySelector('.collapse-text');
      
      if (expandText && collapseText) {
        if (isExpanded) {
          expandText.classList.remove('d-none');
          collapseText.classList.add('d-none');
        } else {
          expandText.classList.add('d-none');
          collapseText.classList.remove('d-none');
        }
      }
    }

    addTouchFeedback() {
      const touchElements = document.querySelectorAll('.mobile-card, .mobile-btn, .form-select');
      
      touchElements.forEach(element => {
        element.addEventListener('touchstart', function() {
          this.style.transform = 'scale(0.98)';
          this.style.transition = 'transform 0.1s ease';
        });
        
        element.addEventListener('touchend', function() {
          this.style.transform = '';
        });
      });
    }
  }

  // Initialize app when DOM is ready
  document.addEventListener('DOMContentLoaded', () => {
    new FeedScheduleApp();
  });
</script>

<style>
  /* Feed Schedule Specific Styles */
  .table-responsive {
    border-radius: 0.375rem;
    overflow: hidden;
  }

  .mobile-card.border-info { border-left: 4px solid var(--bs-info) !important; }
  .mobile-card.border-warning { border-left: 4px solid var(--bs-warning) !important; }
  .mobile-card.border-primary { border-left: 4px solid var(--bs-primary) !important; }
  .mobile-card.border-success { border-left: 4px solid var(--bs-success) !important; }

  @media (max-width: 576px) {
    .mobile-title {
      font-size: 1.3rem !important;
    }
    
    .card-title {
      font-size: 1rem !important;
    }
    
    .badge {
      font-size: 0.7rem !important;
    }
    
    .mobile-card .card-body {
      padding: 0.75rem !important;
    }
  }

  /* Recipe section styling */
  .bg-dark {
    font-size: 0.9rem;
  }
  
  @media (max-width: 768px) {
    .bg-dark {
      font-size: 0.8rem;
    }
  }

  /* Enhanced mobile interactions */
  .mobile-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .mobile-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
</style>
{% endblock %}
